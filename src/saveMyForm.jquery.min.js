/*!
 * Save My Form 2020 - a jQuery Plugin
 * version: 1.4.7
 * Copyright: 2020 Paul Jones
 * MIT license
 */(function(a,b){'use strict';// Underscore debounce function
// Copyright (c) 2009-2018 Jeremy Ashkenas, DocumentCloud and Investigative
// Reporters & Editors
function c(a,b,c){function d(){var j=Date.now()-h;j<b&&0<=j?e=setTimeout(d,b-j):(e=null,!c&&(i=a.apply(g,f),g=f=null))}var e,f,g,h,i;null==b&&(b=100);var j=function(){g=this,f=arguments,h=Date.now();var j=c&&!e;return e||(e=setTimeout(d,b)),j&&(i=a.apply(g,f),g=f=null),i};return j.clear=function(){e&&(clearTimeout(e),e=null)},j.flush=function(){e&&(i=a.apply(g,f),g=f=null,clearTimeout(e),e=null)},j}// functions to maintain compatibility with scripts set up using versions < 1.4.6
a.extend(a.fn,{saveMyForm:function(b,c){return this.each(function(){var d=a.data(this,'plugin_saveMyForm');if(!d){var e='object'==typeof b?b:{};d=a.data(this,'plugin_saveMyForm',new a.saveMyForm(this,e))}'string'==typeof b&&'function'==typeof d[b]&&('array'!=typeof c&&(c=[c]),d[b].apply(d,c))})}}),a.saveMyForm=function(b,c){this._form=b,this.settings=a.extend({},a.saveMyForm.defaults,c),this.init()},a.extend(a.saveMyForm,{defaults:{exclude:':password, input[type="hidden"], :file, .disable_save',include:null,formName:void 0,addPathToName:!1,addPathLength:-255,loadInputs:!0,sameNameSeparator:'___',resetOnSubmit:!0},prototype:{_form:null,init:function(){if(this._elementList=[],this._loadingList={},this._formName='',!!this.setFormName()){var b=this;this._elementList=a.saveMyForm.getElementList(this._formName),a(this._form).find(':input').each(function(){b.addElement(this)}),this.storeElementList(),!0===this.settings.resetOnSubmit&&a(this._form).submit(function(){a.saveMyForm.clearStorage(b._formName)})}},setFormName:function(){var c=a(this._form);if(this._formName=void 0===this.settings.formName?void 0===c.attr('id')?void 0===c.attr('name')?void 0:c.attr('name'):c.attr('id'):this.settings.formName,null==this._formName){var d=a('form').index(c);if(-1!==d)this._formName=b.location.pathname+'_formindex_'+d;else return console.log('Unable to save form data - no id, name or index found'),!1}return!0===this.settings.addPathToName&&(this._formName=this._formName+'___'+b.location.pathname.slice(this.settings.addPathLength)),!0},addElement:function(b){var d=a(b);if(!d.is(this.settings.exclude)&&(null===this.settings.include||d.is(this.settings.include))){var f=this,g=this.getName(b);g&&(d.change(function(a){f.storeElement(a)}).keyup(c(function(a){f.storeElement(a)},500)),void 0===this._loadingList[g]?this._loadingList[g]=0:!d.is(':radio')&&(this._loadingList[g]++,a.data(b,'multiple',this._loadingList[g]),g=g+this.settings.sameNameSeparator+this._loadingList[g]),-1===this._elementList.indexOf(g)&&this._elementList.push(g),!0===this.settings.loadInputs&&this.loadElement(b))}},loadElement:function(b){var c=a(b),d=this.getName(b),e=localStorage.getItem(d);null!==e&&(e=JSON.parse(e),c.is(':checkbox')?c.prop('checked',e).change():c.is(':radio')?e==c.val()&&c.prop('checked',!0).change():c.val(e).change())},storeElement:function(b){var c,d=this.getName(b.target),e=a(b.target);d&&(c=a(b.target).is(':checkbox')?e.prop('checked'):e.val(),localStorage.setItem(d,JSON.stringify(c)))},storeElementList:function(){localStorage.setItem('elementList_'+this._formName,JSON.stringify(this._elementList))},clearElementList:function(){localStorage.removeItem('elementList_'+this._formName)},getName:function(b){var c=a(b),d=c.attr('name')===void 0?c.attr('id')===void 0?void 0:c.attr('id'):c.attr('name');// Set by name first to allow radio groups to function, then id
return void 0===d?void 0:this._formName+'_'+d+(a.data(b,'multiple')===void 0?'':this.settings.sameNameSeparator+a.data(b,'multiple'))}},getElementList:function(a){return JSON.parse(localStorage.getItem('elementList_'+a))||[]},clearStorage:function(b){console.log('clear Storage by form name');try{var c=a.saveMyForm.getElementList(b);if(0<c.length)return a.each(c,function(a,b){localStorage.removeItem(b)}),!0}catch(a){console.log(a)}return!1}}),a.fn.saveMyForm.defaults=a.saveMyForm.defaults,a.fn.saveMyForm.getElementListByFormName=a.saveMyForm.getElementList,a.fn.saveMyForm.clearStorageByFormName=a.saveMyForm.clearStorage})(jQuery,window,document);